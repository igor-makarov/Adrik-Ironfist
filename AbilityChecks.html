<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skills Table</title>
  <style>
    * {
      box-sizing: border-box;
    }

    .row {
      margin-left: -5px;
      margin-right: -5px;
    }

    .column {
      float: left;
      width: 25%;
      padding: 5px;
    }

    @media screen and (max-width: 600px) {
      .column {
        width: 100%;
      }
    }

    /* Clearfix (clear floats) */
    .row::after {
      content: "";
      clear: both;
      display: table;
    }

    table {
      border-collapse: collapse;
      border-spacing: 0;
      width: 100%;
      border: 1px solid #ddd;
    }

    th,
    td {
      text-align: left;
    }

    td.checkCell {
      width: 33%;
    }

    tr:nth-child(odd) {
      background-color: #eee;
    }
  </style>
</head>

<body>
  <script>
    let abilities = {
      'Str': 0,
      'Dex': 1,
      'Con': 2,
      'Int': 2,
      'Wis': 3,
      'Cha': 1
    }

    let proficiencyBonus = 3

    let skills = [
      { skill: 'Acrobatics', modifier: 'Dex' },
      { skill: 'Animal Handling', modifier: 'Wis' },
      { skill: 'Arcana', modifier: 'Int', proficient: true },
      { skill: 'Athletics', modifier: 'Str' },
      { skill: 'Deception', modifier: 'Cha' },
      { skill: 'History', modifier: 'Int', proficient: true },
      { skill: 'Insight', modifier: 'Wis' },
      { skill: 'Intimidation', modifier: 'Cha' },
      { skill: 'Investigation', modifier: 'Int', proficient: true },
      { skill: 'Medicine', modifier: 'Wis' },
      { skill: 'Nature', modifier: 'Int', proficient: true },
      { skill: 'Perception', modifier: 'Wis' },
      { skill: 'Performance', modifier: 'Cha' },
      { skill: 'Persuasion', modifier: 'Cha' },
      { skill: 'Religion', modifier: 'Int' },
      { skill: 'Sleight of Hand', modifier: 'Dex' },
      { skill: 'Stealth', modifier: 'Dex' },
      { skill: 'Survival', modifier: 'Wis', proficient: true },
    ]

    let saves = [
      { save: 'Str', proficient: true },
      { save: 'Dex', proficient: true },
      { save: 'Con' },
      { save: 'Int' },
      { save: 'Wis' },
      { save: 'Cha' }
    ] 


    function abilityBonus(ability) {
      return abilities[ability]
    }

    function createProficiency(proficient, multiplier) {
      multiplier ||= 1
      let symbol = multiplier > 1 ? 'E' : 'P'
      return { proficiency: proficient ? symbol : ' ', bonus: (proficient ? 1 : 0) * proficiencyBonus * multiplier }
    }

    function SkillRow(props) {
      let skill = props.skill
      let proficiencyMultiplier = props.proficiencyMultiplier
      let proficiency = createProficiency(skill.proficient, proficiencyMultiplier)
      let bonus = abilityBonus(skill.modifier) + proficiency.bonus

      return {
        $template: '#skill-row',
        skill: skill,
        proficiency: proficiency,
        bonus: bonus
      }
    }

    function SkillsTable(props) {
      let title = props.title
      let skills = props.skills
      let filter = props.filter ?? (s => true)
      let proficiencyMultiplier = props.proficiencyMultiplier

      return {
        $template: '#skills-table',
        title: props.title,
        skills: skills.filter(filter),
        proficiencyMultiplier: proficiencyMultiplier
      }
    }

    function SaveRow(props) {
      let save = props.save
      let proficiencyMultiplier = props.proficiencyMultiplier
      let proficiency = createProficiency(save.proficient, proficiencyMultiplier)
      let bonus = abilityBonus(save.save) + proficiency.bonus

      return {
        $template: '#save-row',
        save: save,
        proficiency: proficiency,
        bonus: bonus
      }
    }

    function SavesTable(props) {
      let title = props.title
      let saves = props.saves
      let filter = props.filter ?? (s => true)
      let proficiencyMultiplier = props.proficiencyMultiplier

      return {
        $template: '#saves-table',
        title: props.title,
        saves: saves.filter(filter),
        proficiencyMultiplier: proficiencyMultiplier
      }
    }
  </script>

  <template id="skill-row">
    <td><code>[{{proficiency.proficiency}}]</code> {{skill.skill}} ({{skill.modifier}})</td>
    <td class="checkCell">
      <a :href="`dice://roll/d20+${bonus}`">+{{bonus}}</a>
      <a :href="`dice://roll/d20+${bonus}(ADV)`">ADV</a>
      <a :href="`dice://roll/d20+${bonus}(DIS)`">DIS</a>
    </td>
  </template>

  <template id="skills-table">
    <tr>
      <th colspan="2" style="text-align: center;" v-html="title"></th>
    </tr>
    <tr>
      <th>Skill</th>
      <th>Modifier</th>
    </tr>
    <template v-for="skill in skills">
      <tr v-scope="SkillRow({ skill: skill, proficiencyMultiplier: proficiencyMultiplier })"></tr>
    </template>
  </template>

  <template id="save-row">
    <td><code>[{{proficiency.proficiency}}]</code> {{save.save}}</td>
    <td class="checkCell">
      <a :href="`dice://roll/d20+${bonus}`">+{{bonus}}</a>
      <a :href="`dice://roll/d20+${bonus}(ADV)`">ADV</a>
      <a :href="`dice://roll/d20+${bonus}(DIS)`">DIS</a>
    </td>
  </template>

  <template id="saves-table">
    <tr>
      <th colspan="2" style="text-align: center;" v-html="title"></th>
    </tr>
    <tr>
      <th>Save</th>
      <th>Modifier</th>
    </tr>
    <template v-for="save in saves">
      <tr v-scope="SaveRow({ save: save, proficiencyMultiplier: proficiencyMultiplier })"></tr>
    </template>
  </template>

  <div class="row">
    <div class="column">
      <table v-scope="SkillsTable({ title: 'Skills', skills: skills })"></table>
    </div>
    <div class="column">
      <table v-scope="SkillsTable({ title: 'Int skills', skills: skills, filter: s => s.modifier == 'Int' })"></table>
      <table v-scope="SkillsTable({ title: 'Wis skills', skills: skills, filter: s => s.modifier == 'Wis' })"></table>
    </div>
    <div class="column">
      <table
        v-scope="SkillsTable({ title: 'Favored Terrain', skills: skills, filter: s => (s.modifier == 'Int' || s.modifier == 'Wis') && s.proficient, proficiencyMultiplier: 2 })">
      </table>
      <table
        v-scope="SkillsTable({ title: 'Favored Enemy<br>(orc, goblin)<br>use ADV!', skills: skills, filter: s => s.modifier == 'Int' || s.skill == 'Survival' })">
      </table>
      <table
        v-scope="SkillsTable({ title: 'Stonecunning', skills: skills, filter: s => s.skill == 'History', proficiencyMultiplier: 2 })">
      </table>
    </div>
    <div class="column">
      <table v-scope="SavesTable({ title: 'Saves', saves: saves })"></table>
      <table v-scope="SavesTable({ title: 'Dwarven Resilience<br>ADV against poison<br>also half damage', saves: saves, filter: s => s.save == 'Con' })"></table>
    </div>
  </div>
  <script src="https://unpkg.com/petite-vue"></script>
  <script>
    PetiteVue.createApp({
      skills: skills,
      SkillRow,
      SkillsTable
    }).mount()
  </script>
</body>

</html>